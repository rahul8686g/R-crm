{% load static i18n %}
<div class="flex w-full relative bg-white rounded-lg shadow-sm" id="calendar-preview-container">
    <div class="border-b border-secondary-200 bg-white flex items-center justify-between p-3 fixed top-0 w-full z-10">
        <div class="flex items-center gap-4">
            <h3 class="text-md font-semibold ">{% trans 'Preview in Calendar' %}</h3>
            <span class=" border border-[#e9e9e9] text-sm text-gray-500 p-2 rounded-md flex items-center gap-1">
             {% trans 'Format' %} : {% if fiscal_year.format_type == 'quarter_based' %}  {{ fiscal_year.quarter_based_format}} {% elif  fiscal_year.format_type == 'year_based'%} {{ fiscal_year.year_based_format}}{% else %} Standard Fiscal Year {% endif %}
             <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" >
                <title>{% if fiscal_year.format_type == 'quarter_based' %}  {{ fiscal_year.get_quarter_based_format_display}} {% elif  fiscal_year.format_type == 'year_based'%} {{ fiscal_year.get_year_based_format_display }} {% else %} Here using standard fiscal year {% endif %}</title>
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8h.01M12 11v5m0 0h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
            </svg>
            </span>
        </div>
        <div class="flex gap-2">
            <select id="fiscal-year-select"
                    class="js-example-basic-single headselect w-50 mb-3 text-xs"
                    hx-get="{% url 'horilla_core:fiscal_year_calendar' fiscal_year.id %}"
                    hx-target="#calendar-preview-container"
                    hx-swap="outerHTML"
                    hx-include="this"
                    hx-push-url="false"
                    name="fy_instance">
                    {% for instance in fiscal_year_instances %}
                        <option value="{{ instance.id }}"
                                {% if instance.id == selected_instance.id %}selected{% endif %}>
                            {{ instance.name }} ({{ instance.start_date|date:"d/m/Y" }} - {{ instance.end_date|date:"d/m/Y" }})
                            {% if instance.id == current_instance.id %} - Current{% endif %}
                            {% if previous_instance and instance.id == previous_instance.id %} - Previous{% endif %}
                            {% if next_instance and instance.id == next_instance.id %} - Next{% endif %}
                        </option>
                    {% endfor %}
            </select>
        </div>
        <button onclick="closeContentModal()">
            <img src="{% static '/assets/icons/close.svg' %}" alt="" />
        </button>
    </div>
    <div class="bg-[#f8fafc] p-5 h-screen overflow-hidden overflow-y-auto pt-20 w-full">
        {% for quarter in calendar_data %}
            <h3 class="text-md font-semibold mb-2">Quarter {{ quarter.quarter_number }}</h3>
            <div class="grid grid-cols-3 gap-3 mb-4">
                {% for period in quarter.periods %}
                    <div class="bg-white rounded-lg [box-shadow:0px_0px_20px_0px_rgb(0_0_0_/_5%)] p-3">
                        {% if period.is_standard %}
                            <p class="text-sm font-semibold text-center text-primary-600 bg-primary-400 py-2 rounded-tl-md rounded-tr-md">
                                {{ period.month_name }}
                            </p>
                            <div class="overflow-hidden overflow-y-auto border border-primary-400 rounded-bl-md rounded-br-md border-t-0 p-1">
                                <table class="w-full text-xs text-center">
                                    <!-- Days of week header -->
                                    <tr>
                                        {% for day in ordered_days %}
                                            <td class="border border-secondary-50 p-1 font-medium">{{ day }}</td>
                                        {% endfor %}
                                    </tr>
                                    <!-- Calendar weeks -->
                                    {% for week in period.weeks %}
                                        <tr>
                                            {% for day in week %}
                                                <td class="p-1">{% if day %}{{ day }}{% endif %}</td>
                                            {% endfor %}
                                        </tr>
                                    {% endfor %}
                                </table>
                            </div>
                        {% else %}
                            <p class="text-sm font-semibold text-center text-primary-600 bg-primary-400 py-2 rounded-tl-md rounded-tr-md">
                                {% trans "Period" %} {{ period.period_number }}
                            </p>
                            <div class="overflow-hidden overflow-y-auto border border-primary-400 rounded-bl-md rounded-br-md border-t-0 p-1">
                                <table class="w-full text-xs text-center">
                                    <tr>
                                        <th class="p-1">{% trans 'Week' %}</th>
                                        <th class="p-1">{% trans 'Month' %}</th>
                                        {% for day in ordered_days %}
                                            <th class="p-1">{{ day }}</th>
                                        {% endfor %}
                                    </tr>
                                    {% for week in period.weeks %}
                                        <tr>
                                            <td class="p-1">{{ week.week_number }}</td>
                                            <td class="p-1">{{ week.month|capfirst }}</td>
                                            {% for day in week.days %}
                                                <td class="p-1">{% if day %}{{ day }}{% endif %}</td>
                                            {% endfor %}
                                        </tr>
                                    {% endfor %}
                                </table>
                            </div>
                        {% endif %}
                    </div>
                {% endfor %}
            </div>
        {% endfor %}
    </div>
</div>
<script>
    $(document).ready(function () {
        $("select").on("select2:select", function (e) {
            $(this).closest("select")[0].dispatchEvent(new Event("change"));
        });
    });
</script>
