{% load static i18n horilla_tags %}

{% if fiscal_year_type %}
    <div class="grid grid-cols-2 gap-4">
        {% if fiscal_year_type == 'standard' %}
            <!-- Standard Fiscal Year Fields -->
            <div class="{% if 'start_date_month' in full_width_fields %}col-span-2{% else %}col-span-1{% endif %} flex flex-col">
                <label for="{{ form.start_date_month.id_for_label }}" class="text-xs text-gray-600 mb-1 font-medium">
                    {{ form.start_date_month.label }}
                </label>
                <select name="start_date_month" id="{{ form.start_date_month.id_for_label }}"
                        class="js-example-basic-single w-full text-sm" {% if form.start_date_month.field.required %}required{% endif %}>
                    <option value="">Select {{ form.start_date_month.label }}</option>
                    {% for value, label in form.start_date_month.field.choices %}
                        <option value="{{ value }}" {% if form.start_date_month.value == value %}selected{% endif %}>
                            {{ label }}
                        </option>
                    {% endfor %}
                </select>
                {% if form.start_date_month.errors %}
                    <div class="bg-red-50 text-red-500 px-3 py-2 rounded text-xs mt-1">
                        {% for error in form.start_date_month.errors %}
                            {{ error }}
                        {% endfor %}
                    </div>
                {% endif %}
            </div>
            <div class="{% if 'display_year_based_on' in full_width_fields %}col-span-2{% else %}col-span-1{% endif %} flex flex-col">
                <label for="{{ form.display_year_based_on.id_for_label }}" class="text-xs text-gray-600 mb-1 font-medium">
                    {{ form.display_year_based_on.label }}
                </label>
                <select name="display_year_based_on" id="{{ form.display_year_based_on.id_for_label }}"
                        class="js-example-basic-single w-full text-sm" {% if form.display_year_based_on.field.required %}required{% endif %}>
                    <option value="">Select {{ form.display_year_based_on.label }}</option>
                    {% for value, label in form.display_year_based_on.field.choices %}
                        <option value="{{ value }}" {% if form.display_year_based_on.value == value %}selected{% endif %}>
                            {{ label }}
                        </option>
                    {% endfor %}
                </select>
                {% if form.display_year_based_on.errors %}
                    <div class="bg-red-50 text-red-500 px-3 py-2 rounded text-xs mt-1">
                        {% for error in form.display_year_based_on.errors %}
                            {{ error }}
                        {% endfor %}
                    </div>
                {% endif %}
            </div>
        {% elif fiscal_year_type == 'custom' %}
            <!-- Custom Fiscal Year Fields -->
            <div class="{% if 'format_type' in full_width_fields %}col-span-2{% else %}col-span-1{% endif %} flex flex-col">
                <label for="{{ form.format_type.id_for_label }}" class="text-xs text-gray-600 mb-1 font-medium">
                    {{ form.format_type.label }}
                </label>
                <select name="format_type" id="{{ form.format_type.id_for_label }}"
                        class="js-example-basic-single w-full text-sm"
                        hx-get="{% url 'horilla_core:fiscal_year_fields' %}"
                        hx-target="#dynamic-fields"
                        hx-swap="innerHTML"
                       hx-include="#fiscalyear-form-view"
                       hx-trigger="change"
                        {% if form.format_type.field.required %}required{% endif %}>
                    <option value="">Select {{ form.format_type.label }}</option>
                    {% for value, label in form.format_type.field.choices %}
                        <option value="{{ value }}" {% if form.format_type.value == value %}selected{% endif %}>
                            {{ label }}
                        </option>
                    {% endfor %}
                </select>
                {% if form.format_type.errors %}
                    <div class="bg-red-50 text-red-500 px-3 py-2 rounded text-xs mt-1">
                        {% for error in form.format_type.errors %}
                            {{ error }}
                        {% endfor %}
                    </div>
                {% endif %}
            </div>

            {% if show_year_based_format %}
                <div class="{% if 'year_based_format' in full_width_fields %}col-span-2{% else %}col-span-1{% endif %} flex flex-col">
                    <label for="{{ form.year_based_format.id_for_label }}" class="text-xs text-gray-600 mb-1 font-medium">
                        {{ form.year_based_format.label }}
                    </label>
                    <select name="year_based_format" id="{{ form.year_based_format.id_for_label }}"
                            class="js-example-basic-single w-full text-sm"
                            hx-get="{% url 'horilla_core:fiscal_year_fields' %}"
                            hx-target="#dynamic-fields"
                            hx-swap="innerHTML"
                            hx-include="#fiscalyear-form-view"
                            hx-trigger="change"
                            {% if form.year_based_format.field.required %}required{% endif %}>
                        <option value="">Select {{ form.year_based_format.label }}</option>
                        {% for value, label in form.year_based_format.field.choices %}
                            <option value="{{ value }}" {% if form.year_based_format.value == value %}selected{% endif %}>
                                {{ label }}
                            </option>
                        {% endfor %}
                    </select>
                    {% if form.year_based_format.errors %}
                        <div class="bg-red-50 text-red-500 px-3 py-2 rounded text-xs mt-1">
                            {% for error in form.year_based_format.errors %}
                                {{ error }}
                            {% endfor %}
                        </div>
                    {% endif %}
                </div>
                <div class="col-span-2 mt-4 p-4 bg-gray-50 rounded-lg">
                    <h3 class="text-sm font-semibold text-gray-700 mb-2">{% trans 'Configuration Preview'%}</h3>
                    {% if preview_data.format_preview %}
                        <p class="text-sm text-gray-600">{{ preview_data.format_preview }}</p>
                    {% endif %}
                    {% if preview_data.quarter_breakdown %}
                        <ul class="list-disc list-inside text-sm text-gray-600 mt-2">
                            {% for item in preview_data.quarter_breakdown %}
                                <li>{{ item }}</li>
                            {% endfor %}
                        </ul>
                    {% endif %}
                </div>
            {% endif %}
            {% if show_quarter_based_format %}
                <div class="{% if 'quarter_based_format' in full_width_fields %}col-span-2{% else %}col-span-1{% endif %} flex flex-col">
                    <label for="{{ form.quarter_based_format.id_for_label }}" class="text-xs text-gray-600 mb-1 font-medium">
                        {{ form.quarter_based_format.label }}
                    </label>
                    <select name="quarter_based_format" id="{{ form.quarter_based_format.id_for_label }}"
                            class="js-example-basic-single w-full text-sm"
                            hx-get="{% url 'horilla_core:fiscal_year_fields' %}"
                            hx-target="#dynamic-fields"
                            hx-swap="innerHTML"
                            hx-include="#fiscalyear-form-view"
                            hx-trigger="change"
                            {% if form.quarter_based_format.field.required %}required{% endif %}>
                        <option value="">Select {{ form.quarter_based_format.label }}</option>
                        {% for value, label in form.quarter_based_format.field.choices %}
                            <option value="{{ value }}" {% if form.quarter_based_format.value == value %}selected{% endif %}>
                                {{ label }}
                            </option>
                        {% endfor %}
                    </select>
                    {% if form.quarter_based_format.errors %}
                        <div class="bg-red-50 text-red-500 px-3 py-2 rounded text-xs mt-1">
                            {% for error in form.quarter_based_format.errors %}
                                {{ error }}
                            {% endfor %}
                        </div>
                    {% endif %}
                </div>
                {% if preview_data  %}
                    <div class="col-span-2 mt-4 p-4 bg-gray-50 rounded-lg">
                        <h3 class="text-sm font-semibold text-gray-700 mb-2">Configuration Preview</h3>
                        {% if preview_data.format_preview %}
                            <p class="text-sm text-gray-600">{{ preview_data.format_preview }}</p>
                        {% endif %}
                        {% if preview_data.quarter_breakdown %}
                            <ul class="list-disc list-inside text-sm text-gray-600 mt-2">
                                {% for item in preview_data.quarter_breakdown %}
                                    <li>{{ item }}</li>
                                {% endfor %}
                            </ul>
                        {% endif %}
                    </div>
                {% endif %}
            {% endif %}

            <div class="{% if 'start_date_month' in full_width_fields %}col-span-2{% else %}col-span-1{% endif %} flex flex-col">
                <label for="{{ form.start_date_month.id_for_label }}" class="text-xs text-gray-600 mb-1 font-medium">
                    {{ form.start_date_month.label }}
                </label>
                <select name="start_date_month" id="{{ form.start_date_month.id_for_label }}"
                        class="js-example-basic-single w-full text-sm" {% if form.start_date_month.field.required %}required{% endif %}>
                    <option value="">Select {{ form.start_date_month.label }}</option>
                    {% for value, label in form.start_date_month.field.choices %}
                        <option value="{{ value }}" {% if form.start_date_month.value == value %}selected{% endif %}>
                            {{ label }}
                        </option>
                    {% endfor %}
                </select>
                {% if form.start_date_month.errors %}
                    <div class="bg-red-50 text-red-500 px-3 py-2 rounded text-xs mt-1">
                        {% for error in form.start_date_month.errors %}
                            {{ error }}
                        {% endfor %}
                    </div>
                {% endif %}
            </div>

            <div class="{% if 'start_date_day' in full_width_fields %}col-span-2{% else %}col-span-1{% endif %} flex flex-col">
                <label for="{{ form.start_date_day.id_for_label }}" class="text-xs text-gray-600 mb-1 font-medium">
                    {{ form.start_date_day.label }}
                </label>
                <input type="number" name="start_date_day" id="{{ form.start_date_day.id_for_label }}"
                       value="{{ form.start_date_day.value|default_if_none:'' }}"
                       class="text-color-600 p-2 placeholder:text-xs w-full border border-dark-50 rounded-md mt-1 focus-visible:outline-0 placeholder:text-dark-100 text-sm [transition:.3s] focus:border-primary-600"
                       placeholder="Enter {{ form.start_date_day.label }}" {% if form.start_date_day.field.required %}required{% endif %}
                       {% if form.start_date_day.field.required %}required{% endif %}
                        hx-get="{% url 'horilla_core:calculate_week_start_day' %}"
                        hx-target="#week_start_day_container"
                        hx-swap="outerHTML"
                        hx-include="[name='start_date_month'],[name='start_date_day']"
                        hx-trigger="change">
                {% if form.start_date_day.errors %}
                    <div class="bg-red-50 text-red-500 px-3 py-2 rounded text-xs mt-1">
                        {% for error in form.start_date_day.errors %}
                            {{ error }}
                        {% endfor %}
                    </div>
                {% endif %}
            </div>

            <div id="week_start_day_container" class="{% if 'week_start_day' in full_width_fields %}col-span-2{% else %}col-span-1{% endif %} flex flex-col">
                <label for="{{ form.week_start_day.id_for_label }}" class="text-xs text-gray-600 mb-1 font-medium">
                    {{ form.week_start_day.label }}
                </label>
                <select name="week_start_day" id="{{ form.week_start_day.id_for_label }}"
                        class="js-example-basic-single w-full text-sm" {% if form.week_start_day.field.required %}required{% endif %}>
                    <option value="">Select {{ form.week_start_day.label }}</option>
                    {% for value, label in form.week_start_day.field.choices %}
                        <option value="{{ value }}" {% if form.week_start_day.value == value %}selected{% endif %}>
                            {{ label }}
                        </option>
                    {% endfor %}
                </select>
                {% if form.week_start_day.errors %}
                    <div class="bg-red-50 text-red-500 px-3 py-2 rounded text-xs mt-1">
                        {% for error in form.week_start_day.errors %}
                            {{ error }}
                        {% endfor %}
                    </div>
                {% endif %}
            </div>

            <div class="{% if 'display_year_based_on' in full_width_fields %}col-span-2{% else %}col-span-1{% endif %} flex flex-col">
                <label for="{{ form.display_year_based_on.id_for_label }}" class="text-xs text-gray-600 mb-1 font-medium">
                    {{ form.display_year_based_on.label }}
                </label>
                <select name="display_year_based_on" id="{{ form.display_year_based_on.id_for_label }}"
                        class="js-example-basic-single w-full text-sm" {% if form.display_year_based_on.field.required %}required{% endif %}>
                    <option value="">Select {{ form.display_year_based_on.label }}</option>
                    {% for value, label in form.display_year_based_on.field.choices %}
                        <option value="{{ value }}" {% if form.display_year_based_on.value == value %}selected{% endif %}>
                            {{ label }}
                        </option>
                    {% endfor %}
                </select>
                {% if form.display_year_based_on.errors %}
                    <div class="bg-red-50 text-red-500 px-3 py-2 rounded text-xs mt-1">
                        {% for error in form.display_year_based_on.errors %}
                            {{ error }}
                        {% endfor %}
                    </div>
                {% endif %}
            </div>

            <div class="{% if 'number_weeks_by' in full_width_fields %}col-span-2{% else %}col-span-1{% endif %} flex flex-col">
                <label for="{{ form.number_weeks_by.id_for_label }}" class="text-xs text-gray-600 mb-1 font-medium">
                    {{ form.number_weeks_by.label }}
                </label>
                <select name="number_weeks_by" id="{{ form.number_weeks_by.id_for_label }}"
                        class="js-example-basic-single w-full text-sm" {% if form.number_weeks_by.field.required %}required{% endif %}>
                    <option value="">Select {{ form.number_weeks_by.label }}</option>
                    {% for value, label in form.number_weeks_by.field.choices %}
                        <option value="{{ value }}" {% if form.number_weeks_by.value == value %}selected{% endif %}>
                            {{ label }}
                        </option>
                    {% endfor %}
                </select>
                {% if form.number_weeks_by.errors %}
                    <div class="bg-red-50 text-red-500 px-3 py-2 rounded text-xs mt-1">
                        {% for error in form.number_weeks_by.errors %}
                            {{ error }}
                        {% endfor %}
                    </div>
                {% endif %}
            </div>

            <div class="{% if 'period_display_option' in full_width_fields %}col-span-2{% else %}col-span-1{% endif %} flex flex-col">
                <label for="{{ form.period_display_option.id_for_label }}" class="text-xs text-gray-600 mb-1 font-medium">
                    {{ form.period_display_option.label }}
                </label>
                <select name="period_display_option" id="{{ form.period_display_option.id_for_label }}"
                        class="js-example-basic-single w-full text-sm"
                        hx-get="{% url 'horilla_core:fiscal_year_fields' %}"
                        hx-target="#dynamic-fields"
                        hx-swap="innerHTML"
                        hx-include="#fiscalyear-form-view"
                        hx-trigger="change"
                        {% if form.period_display_option.field.required %}required{% endif %}>
                    <option value="">Select {{ form.period_display_option.label }}</option>
                    {% for value, label in form.period_display_option.field.choices %}
                        <option value="{{ value }}" {% if form.period_display_option.value == value %}selected{% endif %}>
                            {{ label }}
                        </option>
                    {% endfor %}
                </select>
                {% if preview_data.period_display %}
                    <p class="text-sm text-gray-600 mt-2">{% trans 'Period Display:' %} {{ preview_data.period_display }}</p>
                {% endif %}
                {% if form.period_display_option.errors %}
                    <div class="bg-red-50 text-red-500 px-3 py-2 rounded text-xs mt-1">
                        {% for error in form.period_display_option.errors %}
                            {{ error }}
                        {% endfor %}
                    </div>
                {% endif %}
            </div>
        {% endif %}
    </div>
{% endif %}
<script>
    $(document).ready(function () {
        $("select").on("select2:select", function (e) {
            $(this).closest("select")[0].dispatchEvent(new Event("change"));
        });
    });
</script>
