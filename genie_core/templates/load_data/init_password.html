{% extends "login.html" %}
{% load static i18n %}
{% block login %}


<div id="load-sec" class="bg-white p-[20px] rounded-md shadow w-[900px]">
    <div id="messages-container" style="display:none;">
        {% for message in messages %}
            <div class="message" data-level="{{ message.tags }}" data-message="{{ message }}"></div>
        {% endfor %}
    </div>


  <!-- Content -->
  <div class="p-5">
    <h2 class="text-lg font-semibold">{% trans "Database Authentication" %}</h2>
    <p class="mb-5 text-sm text-color-600">
      {% trans "Authenticate with your password to load demo database" %}
    </p>

    <form
      id="load-demo-form"
      method="post"
      action="{% url 'horilla_core:load_demo_data' %}"
      {% comment %} hx-post="{% url 'horilla_core:load_demo_data' %}"
      hx-target="#load-sec"
      hx-swap="outerHTML"
      hx-push-url="true"
      hx-select="#load-sec" {% endcomment %}
      >
      {% csrf_token %}

      <label class="text-sm text-color-600">{% trans "Password" %}</label>
      <div class="relative">
        <input
          id="demo-password-input"
          name="init_password"
          type="password"
          value="{{ password }}"
          placeholder="Database authentication password"
          class="text-color-600 p-2 placeholder:text-xs font-normal pr-[40px] w-full border border-dark-50 rounded-md mt-1 focus-visible:outline-0 placeholder:text-dark-100 text-sm [transition:.3s] focus:border-primary-600"
        />
        <button type="button" id="toggle-demo-password-btn" class="absolute right-3 top-0 bottom-0 m-auto cursor-pointer">
          <img id="demoEyeIcon" src="{% static 'assets/icons/eye.svg' %}" alt="Toggle visibility" class="hidden" />
          <img id="demoEyeHideIcon" src="{% static 'assets/icons/eye-hide.svg' %}" width="21" alt="Toggle visibility" />
        </button>
      </div>

      {% if error %}
        <p class="text-red-500 text-sm mt-3">{{ error }}</p>
      {% endif %}

      <!-- Buttons -->
      <div class="flex justify-between pt-5">
        <button
            type="button"
            hx-get="{% url 'horilla_core:login' %}"
            hx-target="#load-sec"
            hx-select="#sec1"
            hx-swap="outerHTML"
            class="text-sm text-primary-600 hover:underline">
            {% trans "Back to Login" %}
        </button>

        <button
            type="submit"
            hx-indicator="#loadingIndicator"
            class="border-[1px] border-[solid] border-[#e54f38] hover:border-[#9b210f] hover:bg-secondary-600 rounded-[5px] px-[15px] py-[8px] text-[#e54f38] flex gap-3 btn-with-icon border-[#e54f38] [transition:.3s] hover:text-[white]">
            {% trans "Authenticate" %}
          <img src="{% static 'assets/icons/ar3.svg' %}" alt="" />
        </button>
    </div>
</form>
</div>
<div id="loadingIndicator" class="htmx-indicator">
    <div class="flex justify-center items-center p-4">
        <div class="animate-spin rounded-full h-8 w-8 border-t-2 border-b-2 border-[#e54f38]"></div>
    </div>
</div>

  <!-- Password Toggle Script -->
  <script>
    document.body.addEventListener('click', function(e) {
      if (e.target.closest('#toggle-demo-password-btn')) {
        const passwordInput = document.getElementById('demo-password-input');
        const eyeIcon = document.getElementById('demoEyeIcon');
        const eyeHideIcon = document.getElementById('demoEyeHideIcon');

        if (passwordInput.type === 'password') {
          passwordInput.type = 'text';
          eyeIcon.classList.remove('hidden');
          eyeHideIcon.classList.add('hidden');
        } else {
          passwordInput.type = 'password';
          eyeIcon.classList.add('hidden');
          eyeHideIcon.classList.remove('hidden');
        }
      }
    });


  </script>
</div>

{% endblock login %}
