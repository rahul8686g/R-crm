 {% load i18n %}
 {% load static %}
<div id="import-container" class="{% if single_import %}p-6{% endif %}">
    {% if single_import %}
    <div class="flex justify-between items-center mb-2">
        <h2 class="text-md font-semibold">Import {{selected_module }}</h2>
        <button type="button" onclick="closeModal()" class="text-gray-500 hover:text-red-500 text-xl cursor-pointer">
            <img src="{% static 'assets/icons/close.svg' %}" alt="Close" />
        </button>
    </div>
    {% endif %}
    <div class="{% if not single_import %} max-w-[100%] md:max-w-[80%] m-auto {% endif %}pt-5" id="styled-task">
        <div id="step1">
            <ul class="progress mb-8 overflow-hidden overflow-x-auto">
                <li class="active">
                    <div class="sec">
                        <span class="bg-primary-600 h-8 w-8 flex items-center justify-center rounded-full text-[white]">1</span>
                        <p class="text-sm mt-2 text-[#737791] font-medium text-center lg:text-left">{% trans "Upload Files" %}</p>
                    </div>
                </li>
                <li class="">
                    <div class="sec flex [flex-flow:column] items-center">
                        <span class="bg-white border border-dark-50 h-8 w-8 flex items-center justify-center rounded-full text-[gray]">2</span>
                        <p class="text-sm mt-2 text-[#737791] font-medium text-center lg:text-inherit">{% trans "Map Fields" %}</p>
                    </div>
                </li>
                <li class="">
                    <div class="sec flex [flex-flow:column] items-center">
                        <span class="bg-white border border-dark-50 h-8 w-8 flex items-center justify-center rounded-full text-[gray]">3</span>
                        <p class="text-sm mt-2 text-[#737791] font-medium text-center lg:text-inherit">{% trans "Action" %}</p>
                    </div>
                </li>
                <li>
                    <div class="sec flex [flex-flow:column] items-end">
                        <span class="bg-white border border-dark-50 h-8 w-8 flex items-center justify-center rounded-full text-[gray] absolute top-[0] right-[0]">4</span>
                        <p class="text-sm mt-2 text-[#737791] font-medium text-center lg:text-inherit">{% trans "Import" %}</p>
                    </div>
                </li>
            </ul>
            <form hx-post="{% url 'horilla_core:import_step1' %}" hx-target="#import-container" hx-swap="innerHTML" enctype="multipart/form-data">
                {% csrf_token %}
                <div class="grid grid-cols-12 gap-4">
                    <div class="col-span-12 md:col-span-6">
                        <div class="flex flex-col gap-1">
                            <label for="" class="text-xs text-color-600">{% trans "Select Module" %}</label>
                            <select name="module" class="js-example-basic-single headselect w-full" required >
                                <option value="">{% trans "Choose Module" %}</option>
                                {% for module in modules %}
                                    <option value="{{ module.name }}"
                                            {% if selected_module == module.name %}selected{% endif %}>
                                        {{ module.label }}
                                    </option>
                                {% endfor %}
                            </select>
                            {% if error_message %}
                            <div class="bg-red-50 text-red-500 px-3 py-2 rounded text-xs mt-1">
                                {{ error_message }}
                            </div>
                            {% endif %}
                        </div>
                    </div>
                    <div class="col-span-6">
                        <div class="flex flex-col gap-1">
                            <label for="" class="text-xs text-color-600">{% trans "Import Name" %}</label>
                            <input type="text" name="import_name" placeholder="Enter Import Name"
                                value="{{ selected_import_name|default:'' }}"
                                class="text-color-600 mt-1 px-2 py-[7px] placeholder:text-xs pr-[40px] w-full border border-dark-50 rounded-[3px] focus-visible:outline-0 placeholder:text-dark-100 text-sm [transition:.3s] focus:border-primary-600" required>
                        </div>
                    </div>
                    <div class="col-span-12">
                        <div>
                            <label class="text-xs text-color-600 mb-1">{% trans "Upload File" %}</label>
                            <label for="profileImageUpload"
                                class="bg-white flex flex-col items-center justify-center w-full h-[6rem] border-2 border-dashed border-[#d5d5d5] rounded-lg cursor-pointer hover:border-gray-400 transition relative">
                                <div id="uploadBoxContent"
                                    class="flex flex-col items-center justify-center text-center px-2">
                                    {% if selected_filename %}
                                        <p class="text-sm font-semibold text-gray-700 truncate max-w-full">{{ selected_filename }}</p>
                                        <p class="text-xs text-[#9e9e9e]">{% trans "File already uploaded" %}</p>
                                    {% else %}
                                        <i class="fa-solid fa-arrow-up-from-bracket text-xl mb-2 text-gray-500"></i>
                                        <p class="text-sm font-semibold text-gray-700">{% trans "Upload File" %}</p>
                                        <p class="text-xs text-[#9e9e9e]">{% trans "CSV, XLS, XLSX ( Max 10MB )" %}</p>
                                    {% endif %}
                                </div>
                                <input id="profileImageUpload" name="file" type="file" accept=".csv,.xlsx,.xls"
                                       class="hidden" {% if not selected_filename %}required{% endif %} />
                            </label>
                        </div>
                    </div>
                    <div class="col-span-12 flex justify-end mt-5">
                        <button type="submit"
                            class="nextBtn text-sm px-5 py-2 bg-primary-600 rounded-md hover:bg-primary-800 transition duration-300 text-[white]">
                            {% trans "Next" %}
                        </button>
                    </div>
                </div>
            </form>
        </div>
    </div>

    <script>
        function attachFileInputListener() {
            const fileInput = document.getElementById("profileImageUpload");
            const uploadBoxContent = document.getElementById("uploadBoxContent");

            if (fileInput) {
                fileInput.addEventListener("change", function () {
                    const file = this.files[0];
                    if (file) {
                        uploadBoxContent.innerHTML = `
                            <p class="text-sm font-semibold text-gray-700 truncate max-w-full">${file.name}</p>
                        `;
                    } else {
                        uploadBoxContent.innerHTML = `
                            <i class="fa-solid fa-arrow-up-from-bracket text-xl mb-2 text-gray-500"></i>
                            <p class="text-sm font-semibold text-gray-700">Upload File</p>
                            <p class="text-xs text-[#9e9e9e]">CSV, XLS, XLSX ( Max 10MB )</p>
                        `;
                    }
                });
            }
        }

        attachFileInputListener();

        document.addEventListener("htmx:afterSwap", function (event) {
            if (event.detail.target.id === "import-container") {
                attachFileInputListener();
            }
        });
    </script>
</div>
